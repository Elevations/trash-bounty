#pragma checksum "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\Pages\Dashboard.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "00b72320ffc3a7e7b4dbfc75fefe97dce2f02d66"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace TrashBountyWebsite.Client.Pages
{
    #line hidden
    using System;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using System.Collections.Generic;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using System.ComponentModel.DataAnnotations;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using TrashBountyWebsite.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using TrashBountyWebsite.Client.Authentication;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using TrashBountyWebsite.Client.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using AspNetMonsters.Blazor.Geolocation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using TrashBountyLib;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\_Imports.razor"
using TrashBountyLib.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\Pages\Dashboard.razor"
using BlazorLeaflet;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\Pages\Dashboard.razor"
using BlazorLeaflet.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\Pages\Dashboard.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\Pages\Dashboard.razor"
using Blazor.FileReader;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/dashboard")]
    public partial class Dashboard : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 274 "C:\Users\Mihir\Source\Repos\TrashBounty\TrashBountyWebsite\Client\Pages\Dashboard.razor"
 
    private Location location;

    ElementReference inputReference;
    ElementReference completedBountyImage;

    private List<Bounty> bounties;
    private List<APIUser> users;

    private List<Map> maps = new List<Map>();

    private NewBounty newBounty = new NewBounty();
    private NewCompletedBounty newCompletedBounty = new NewCompletedBounty();

    private string postBountyFormStatus = "closed";
    private string completeBountyFormStatus = "closed";
    private string buttonStatus = "closed";

    private string selectedBounty;

    protected override async Task OnInitializedAsync()
    {
        location = await LocationService.GetLocationAsync();
        bounties = await HttpClient.GetFromJsonAsync<List<Bounty>>("https://localhost:44399/api/bounty/open/100");
        users = await HttpClient.GetFromJsonAsync<List<APIUser>>($"https://localhost:44399/api/users");
    }

    private async Task PostBounty()
    {
        // Get the image
        var file = (await fileReader.CreateReference(inputReference).EnumerateFilesAsync()).FirstOrDefault();

        if (file == null)
        {
            return;
        }

        using (var ms = await file.CreateMemoryStreamAsync((int) (await file.ReadFileInfoAsync()).Size))
        {
            newBounty.ImageData = Convert.ToBase64String(ms.ToArray());
        }

        if (newBounty.ImageData == null)
        {
            Console.WriteLine("There is no image ._.");
            return;
        }

        // Re-get location
        location = await LocationService.GetLocationAsync();
        newBounty.Latitude = location.Latitude;
        newBounty.Longitude = location.Longitude;

        // Make http request
        var token = await localStorage.GetItemAsync<string>("authToken");

        HttpClient.DefaultRequestHeaders.Add("Authorization", $"Bearer {token}");
        var response = await HttpClient.PostAsJsonAsync($"https://localhost:44399/api/bounty/open", newBounty);
        HttpClient.DefaultRequestHeaders.Remove("Authorization");

        postBountyFormStatus = "closed";
        buttonStatus = "closed";
    }

    private async Task CompleteBounty()
    {
        if (selectedBounty == null)
            return;

        // Get the image
        var file = (await fileReader.CreateReference(completedBountyImage).EnumerateFilesAsync()).FirstOrDefault();

        if (file == null)
        {
            return;
        }

        using (var ms = await file.CreateMemoryStreamAsync((int)(await file.ReadFileInfoAsync()).Size))
        {
            newCompletedBounty.ImageData = Convert.ToBase64String(ms.ToArray());
        }

        if (newCompletedBounty.ImageData == null)
        {
            Console.WriteLine("There is no image ._.");
            return;
        }

        newCompletedBounty.BountyId = selectedBounty;

        // Make http request
        var token = await localStorage.GetItemAsync<string>("authToken");

        HttpClient.DefaultRequestHeaders.Add("Authorization", $"Bearer {token}");
        var response = await HttpClient.PostAsJsonAsync($"https://localhost:44399/api/bounty/close", newCompletedBounty);
        HttpClient.DefaultRequestHeaders.Remove("Authorization");

        completeBountyFormStatus = "closed";
        buttonStatus = "closed";
    }

    private void ButtonEvent(MouseEventArgs e)
    {
        if (buttonStatus.Equals("closed"))
        {
            buttonStatus = "opened";
            postBountyFormStatus = "opened";
        }
        else
        {
            buttonStatus = "closed";
            postBountyFormStatus = "closed";
            completeBountyFormStatus = "closed";
            selectedBounty = null;
        }
    }

    private void OpenCompleteBountyForm(string bountyId)
    {
        selectedBounty = bountyId;
        buttonStatus = "opened";
        completeBountyFormStatus = "opened";
    }

    private class Foo
    {

    };

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IFileReaderService fileReader { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime jsRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Blazored.LocalStorage.ILocalStorageService localStorage { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HttpClient HttpClient { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private LocationService LocationService { get; set; }
    }
}
#pragma warning restore 1591
